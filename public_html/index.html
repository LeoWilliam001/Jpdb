<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Project Management Form</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <style>
            body {
                font-family: 'Arial', sans-serif;
                background-color: #f7f7f7;
            }

            .container {
                margin-top: 50px;
                background-color: #fff;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            h2 {
                font-size: 28px;
                margin-bottom: 20px;
                color: #333;
                text-align: center;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            label {
                font-weight: bold;
                font-size: 14px;
                color: #555;
            }

            .form-control {
                padding: 10px;
                font-size: 14px;
                border: 1px solid #ddd;
                border-radius: 5px;
                transition: all 0.3s ease;
            }

            .form-control:focus {
                border-color: #007bff;
                box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
            }

            .btn-primary {
                background-color: #007bff;
                border-color: #007bff;
                padding: 10px 20px;
                font-size: 16px;
                border-radius: 5px;
                transition: background-color 0.3s ease;
            }

            .btn-primary:hover {
                background-color: #0056b3;
            }

            #projectReset:hover {
                background-color: #ff4444;
                border-color: #ff4444;
            }

            .btn {
                width: 100px;
                margin-right: 10px;
            }

            #projectSave, #projectReset {
                display: inline-block;
                width: 150px;
                margin-top: 20px;
                margin-right: 20px;
                text-align: center;
                font-size: 16px;
            }

            @media (max-width: 768px) {
                .form-control {
                    font-size: 12px;
                    padding: 8px;
                }

                .btn {
                    font-size: 14px;
                    padding: 8px;
                }

                .container {
                    padding: 20px;
                }
            }
        </style>

    </head>
    <body>
        <div class="container">
            <h2>Project Details Form</h2>
            <form id="projectForm" method="post">
                <div class="form-group">
                    <label for="projectId">Project ID:</label>
                    <input type="text" class="form-control" name="projectId" id="projectId" placeholder="Enter Project ID" required>
                </div>
                <div class="form-group">
                    <label for="projectName">Project Name:</label>
                    <input type="text" class="form-control" name="projectName" id="projectName" placeholder="Enter Project Name" required>
                </div>
                <div class="form-group">
                    <label for="assignedTo">Assigned To:</label>
                    <input type="text" class="form-control" name="assignedTo" id="assignedTo" placeholder="Enter Assignee Name" required>
                </div>
                <div class="form-group">
                    <label for="assignmentDate">Assignment Date:</label>
                    <input type="date" class="form-control" name="assignmentDate" id="assignmentDate" required>
                </div>
                <div class="form-group">
                    <label for="deadline">Deadline:</label>
                    <input type="date" class="form-control" name="deadline" id="deadline" required>
                </div>
                <input type="button" class="btn btn-primary" id="projectSave" value="Save" onclick="saveProject();">
                <input type="button" class="btn btn-primary" id="projectReset" value="Reset" onclick="resetForm();">
                <input type="button" class="btn btn-primary" id="projectUpdate" value="Update" onclick="updateProject();">
            </form>
        </div>

        <script>
            $("#projectId").focus();

            function validateAndGetFormData() {
                var projectIdVar = $("#projectId").val();
                if (projectIdVar === "") {
                    alert("Project ID is a required value.");
                    $("#projectId").focus();
                    return "";
                }

                var projectNameVar = $("#projectName").val();
                if (projectNameVar === "") {
                    alert("Project Name is a required value.");
                    $("#projectName").focus();
                    return "";
                }

                var assignedToVar = $("#assignedTo").val();
                if (assignedToVar === "") {
                    alert("Assigned To is a required value.");
                    $("#assignedTo").focus();
                    return "";
                }

                var assignmentDateVar = $("#assignmentDate").val();
                if (assignmentDateVar === "") {
                    alert("Assignment Date is a required value.");
                    $("#assignmentDate").focus();
                    return "";
                }

                var deadlineVar = $("#deadline").val();
                if (deadlineVar === "") {
                    alert("Deadline is a required value.");
                    $("#deadline").focus();
                    return "";
                }

                var jsonStrObj = {
                    projectID: projectIdVar,
                    projectName: projectNameVar,
                    assignedTo: assignedToVar,
                    assignmentDate: assignmentDateVar,
                    deadline: deadlineVar
                };

                return JSON.stringify(jsonStrObj);
            }

            function createPUTRequest(connToken, jsonObj, dbName, relName) {
                var putRequest = "{\n" +
                        "\"token\" : \"" + connToken + "\",\n" +
                        "\"dbName\": \"" + dbName + "\",\n" +
                        "\"cmd\" : \"PUT\",\n" +
                        "\"rel\" : \"" + relName + "\",\n" +
                        "\"jsonStr\": \n" + jsonObj + "\n" +
                        "}";
                return putRequest;
            }

            function updateProject() {
                var projectIdVar = $("#projectId").val();

                if (projectIdVar === "") {
                    alert("Please enter the Project ID to update.");
                    $("#projectId").focus();
                    return;
                }

                // Get the existing project using Project ID
                var getRequestStr = createGETRequest("90934517|-31949226078299190|90962906", "COLLEGE-DB", "PROJECT-TABLE", JSON.stringify({projectID: projectIdVar}));

                // Use AJAX to get the existing project data
                jQuery.ajaxSetup({async: false});
                var existingProjectResponse = executeCommand(getRequestStr, "http://api.login2explore.com:5577", "/api/irl");

                var existingProject = JSON.parse(existingProjectResponse.data);

                if (!existingProject || Object.keys(existingProject).length === 0) {
                    alert("No project found with the provided Project ID.");
                    jQuery.ajaxSetup({async: true});
                    return;
                }

                // Prepare the updated data
                var updatedData = {
                    [existingProject.recNo]: {}  // Use record number as the key
                };

                // Update only fields that have new values
                if ($("#projectName").val() !== "") {
                    updatedData[existingProject.recNo]["projectName"] = $("#projectName").val();
                }
                if ($("#assignedTo").val() !== "") {
                    updatedData[existingProject.recNo]["assignedTo"] = $("#assignedTo").val();
                }
                if ($("#assignmentDate").val() !== "") {
                    updatedData[existingProject.recNo]["assignmentDate"] = $("#assignmentDate").val();
                }
                if ($("#deadline").val() !== "") {
                    updatedData[existingProject.recNo]["deadline"] = $("#deadline").val();
                }

                // Create and send the update request
                var updateRequestStr = createUPDATERecordRequest("90934517|-31949226078299190|90962906", updatedData, "COLLEGE-DB", "PROJECT-TABLE", existingProject.recNo);

                executeCommand(updateRequestStr, "http://api.login2explore.com:5577", "/api/iml")
                        .then(function (updateResponse) {
                            // Handle the response from the server
                            if (updateResponse.status === 200) {
                                alert("Project updated successfully!");
                            } else {
                                alert("Error updating project: " + JSON.stringify(updateResponse));
                            }
                            resetForm();  // Optionally reset the form after update
                        })
                        .catch(function (error) {
                            alert("Error: " + JSON.stringify(error));
                        });

                jQuery.ajaxSetup({async: true});
            }



            function executeCommand(reqString, dbBaseUrl, apiEndPointUrl) {
                var url = dbBaseUrl + apiEndPointUrl;
                var jsonObj;
                $.post(url, reqString, function (result) {
                    jsonObj = JSON.parse(result);
                }).fail(function (result) {
                    var dataJsonObj = result.responseText;
                    jsonObj = JSON.parse(dataJsonObj);
                });
                return jsonObj;
            }

            function resetForm() {
                $("#projectId").val("");
                $("#projectName").val("");
                $("#assignedTo").val("");
                $("#assignmentDate").val("");
                $("#deadline").val("");
                $("#projectId").focus();
            }

            function saveProject() {
                var jsonStr = validateAndGetFormData();
                if (jsonStr === "") {
                    return;
                }

                var putReqStr = createPUTRequest("90934517|-31949226078299190|90962906", jsonStr, "COLLEGE-DB", "PROJECT-TABLE");
                alert(putReqStr);
                jQuery.ajaxSetup({async: false});
                var resultObj = executeCommand(putReqStr, "http://api.login2explore.com:5577", "/api/iml");
                alert(JSON.stringify(resultObj));
                jQuery.ajaxSetup({async: true});
                resetForm();
            }
        </script>
    </body>
</html>
